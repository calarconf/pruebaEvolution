-- Crear tabla Autores
CREATE TABLE autores (
    id_autor SERIAL PRIMARY KEY,
    nombre VARCHAR(255) NOT NULL
);
-- Crear tabla Libros
CREATE TABLE libros (
    id_libro SERIAL PRIMARY KEY,
    titulo VARCHAR(255) NOT NULL,
    id_autor INT NOT NULL,
    categoria VARCHAR(100) NOT NULL,
    cantidad_disponible INT NOT NULL DEFAULT 0,
    FOREIGN KEY (id_autor) REFERENCES autores(id_autor) ON DELETE CASCADE
);
-- Crear tabla Usuarios
CREATE TABLE usuarios (
    id_usuario SERIAL PRIMARY KEY,
    nombre VARCHAR(255) NOT NULL,
    correo_electronico VARCHAR(255) NOT NULL UNIQUE
);
-- Crear tabla Prestamos
CREATE TABLE prestamos (
    id_prestamo SERIAL PRIMARY KEY,
    id_usuario INT NOT NULL,
    id_libro INT NOT NULL,
    fecha_prestamo DATE NOT NULL DEFAULT CURRENT_DATE,
    fecha_devolucion DATE,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE,
    FOREIGN KEY (id_libro) REFERENCES libros(id_libro) ON DELETE CASCADE
);
-- Índices para mejorar el rendimiento
CREATE INDEX idx_libros_autor ON libros(id_autor);
CREATE INDEX idx_prestamos_usuario ON prestamos(id_usuario);
CREATE INDEX idx_prestamos_libro ON prestamos(id_libro);


-- Insertar autores
INSERT INTO autores (nombre) VALUES 
    ('Gabriel García Márquez'),
    ('Isabel Allende'),
    ('Jorge Luis Borges');

-- Insertar libros
INSERT INTO libros (titulo, id_autor, categoria, cantidad_disponible) VALUES 
    ('Cien años de soledad', 1, 'Ficción', 5),
    ('El amor en los tiempos del cólera', 1, 'Romance', 3),
    ('La casa de los espíritus', 2, 'Ficción', 4),
    ('Ficciones', 3, 'Cuentos', 6);

-- Insertar usuarios
INSERT INTO usuarios (nombre, correo_electronico) VALUES 
    ('Juan Pérez', 'juan.perez@email.com'),
    ('María González', 'maria.gonzalez@email.com');

-- Insertar préstamos
INSERT INTO prestamos (id_usuario, id_libro, fecha_prestamo) VALUES 
    (1, 1, '2026-01-15'),
    (2, 3, '2026-01-20');




-- Índice en la columna de búsqueda (WHERE)
CREATE INDEX idx_autores_n








ombre ON autores(nombre);

-- Índice en la foreign key (JOIN)
CREATE INDEX idx_libros_autor ON libros(id_autor);

-- Índice compuesto para cubrir la consulta completa
CREATE INDEX idx_libros_covering ON libros(id_autor, titulo, categoria);


SELECT 
    l.titulo,
    l.categoria
FROM 
    libros l
INNER JOIN 
    autores a ON l.id_autor = a.id_autor
WHERE 
    a.nombre = 'Gabriel García Márquez';